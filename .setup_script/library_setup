#!/bin/sh

DEVSETTING_DIR=$HOME/.devsetting

systemMessage=""

## Check current environments #################################################
supportNVIM=0
case "$(uname -s)" in
    Linux*)     machine=Linux; supportNVIM=1;;
    Darwin*)    machine=Mac; supportNVIM=1;;
    CYGWIN*)    machine=Cygwin;;
    MINGW*)     machine=MinGw;;
    *)          machine="UNKNOWN:$(uname -s)"
esac

dist="Unsupported"
if [ "$machine" = "Linux" ]; then
    case "$(cat /etc/issue)" in
        *Ubuntu*)   dist=Ubuntu;;
        *SUSE*)     dist=SUSE;;
        *)          dist="Unsupported"
    esac
fi

## Install prerequiste library - need root access #############################
if [ "$dist" = "SUSE" ]; then
    echo "SUSE"
    sudo zypper install --type pattern Basis-Devel
    sudo zypper install libevent-devel ncurses-devel        # for tmux
    sudo zypper install pcre-devel zlib-devel xz-devel      # for ag
    sudo zypper install readline-devel                      # for cgdb
elif [ "$dist" = "Ubuntu" ]; then
    echo "Ubuntu"
    sudo apt-get install -y build-essential
    sudo apt-get install -y autotools-dev automake libevent-dev libncurses-dev pkg-config   # for tmux
    sudo apt-get install -y automake pkg-config libpcre3-dev zlib1g-dev liblzma-dev         # for ag
fi

## Download external libraries ################################################
# NeoVim - https://github.com/neovim/neovim/wiki/Installing-Neovim
if [ $supportNVIM = 1 ] && [ -z "$(command -v nvim)" ]; then
    if [ "$dist" = "SUSE" ]; then
        cd $DEVSETTING_DIR/bin
        wget https://github.com/neovim/neovim/releases/download/v0.3.4/nvim.appimage --no-check-certificate
        chmod +x nvim.appimage
        mv nvim.appimage nvim
    elif [ "$dist" = "Ubuntu" ]; then
        echo "Please run \"sudo apt-get install nvim\""
    elif [ "$dist" = "Unsupported" ]; then
        echo "this distribution doesn't support nvim - $dist"
    fi
fi

[ ! -d "$DEVSETTING_DIR/git/tmux" ] &&
    git clone https://github.com/tmux/tmux.git $DEVSETTING_DIR/git/tmux
[ ! -d "$DEVSETTING_DIR/git/uctag" ] &&
    git clone https://github.com/universal-ctags/ctags.git $DEVSETTING_DIR/git/uctag
[ ! -d "$DEVSETTING_DIR/git/ag" ] &&
    git clone https://github.com/ggreer/the_silver_searcher.git $DEVSETTING_DIR/git/ag
[ ! -d "$DEVSETTING_DIR/git/tig" ] &&
    git clone https://github.com/jonas/tig.git $DEVSETTING_DIR/git/tig
[ ! -d "$DEVSETTING_DIR/git/cgdb" ] &&
    git clone git://github.com/cgdb/cgdb.git $DEVSETTING_DIR/git/cgdb

if [ ! -d "$DEVSETTING_DIR/git/lynx" ]; then
    wget https://invisible-mirror.net/archives/lynx/tarballs/lynx2.8.9rel.1.tar.gz -P $DEVSETTING_DIR/git
    tar zxvf $DEVSETTING_DIR/git/lynx2.8.9rel.1.tar.gz -C $DEVSETTING_DIR/git
    rm $DEVSETTING_DIR/git/lynx2.8.9rel.1.tar.gz
    mv $DEVSETTING_DIR/git/lynx2.8.9rel.1 $DEVSETTING_DIR/git/lynx
fi
